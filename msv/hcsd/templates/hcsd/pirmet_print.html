<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>طباعة التصريح</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');

    :root {
      --ink: #1b1b1b;
      --muted: #5e5e5e;
      --line: #2a2a2a;
      --paper: #ffffff;
      --accent: #1f5a4b;
      --accent-soft: #e2ede9;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Cairo", "Noto Kufi Arabic", "Tahoma", sans-serif;
      color: var(--ink);
      background: #f3efe6;
    }

    .print-page {
      padding: 24px 16px 40px;
    }

    .print-card {
      max-width: 900px;
      margin: 0 auto;
      background: var(--paper);
      border: 2px solid var(--line);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
      padding: 20px;
    }

    .print-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-start;
      margin-bottom: 16px;
    }

    .print-actions a,
    .print-actions button {
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      text-decoration: none;
      background: var(--accent);
      color: #fff;
    }

    .print-actions .secondary {
      background: #494949;
    }

    .print-header {
      display: grid;
      grid-template-columns: 1fr 140px 1fr;
      align-items: center;
      gap: 12px;
      border-bottom: 2px solid var(--line);
      padding-bottom: 12px;
      margin-bottom: 12px;
    }

    .header-block {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }

    .header-block strong {
      display: block;
      font-size: 13px;
      color: var(--ink);
    }

    .logo-box {
      width: 110px;
      height: 70px;
      border: 2px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--muted);
      background: #fff;
      margin: 0 auto;
    }

    .permit-title {
      text-align: center;
      font-weight: 700;
      font-size: 16px;
      padding: 8px 10px;
      border: 2px solid var(--line);
      background: var(--accent-soft);
      margin: 10px 0 8px;
    }

    .permit-subtitle {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .form-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12.5px;
      border: 1.5px solid var(--line);
    }

    .form-table th,
    .form-table td {
      border: 1px solid var(--line);
      padding: 6px 8px;
      vertical-align: middle;
    }

    .form-table th {
      font-weight: 600;
      color: var(--muted);
      width: 26%;
      background: #fff;
      text-align: left;
      direction: ltr;
    }

    .form-table td {
      text-align: right;
      direction: rtl;
      font-weight: 600;
    }

    .form-table .rtl-label {
      width: 26%;
      font-weight: 600;
      color: var(--muted);
      text-align: right;
      direction: rtl;
    }

    .table-section {
      background: var(--accent-soft);
      text-align: center !important;
      font-weight: 700;
      color: var(--ink);
    }

    .engineer-table,
    .activity-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12.5px;
      margin-top: 8px;
      border: 1.5px solid var(--line);
    }

    .engineer-table th,
    .engineer-table td,
    .activity-table th,
    .activity-table td {
      border: 1px solid var(--line);
      padding: 6px 8px;
      text-align: center;
    }

    .engineer-table td,
    .activity-table td {
      text-align: right;
      direction: rtl;
    }

    .activity-table th {
      background: #fff;
      color: var(--muted);
      font-weight: 600;
    }

    .activities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px;
    }

    .activity-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
    }

    .activity-list li {
      border: 1px solid var(--line);
      padding: 6px 10px;
      background: #fff;
    }

    .footer-meta {
      margin-top: 16px;
      font-size: 12px;
      color: var(--muted);
      text-align: left;
    }

    @page {
      size: A4;
      margin: 12mm;
    }

    @media print {
      body {
        background: #fff;
      }

      .print-page {
        padding: 0;
      }

      .print-card {
        border: none;
        box-shadow: none;
        padding: 0;
      }

      .no-print {
        display: none !important;
      }

      .print-card {
        border: none;
        box-shadow: none;
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="print-page">
    <div class="print-card">
      <div class="print-actions no-print">
        <button type="button" onclick="window.print()">طباعة</button>
        <a class="secondary" href="{% url 'pirmet_detail' pirmet.id %}">العودة للتفاصيل</a>
      </div>

      <header class="print-header">
        <div class="header-block" style="text-align: right;">
          <strong>إدارة الرقابة والسلامة الصحية</strong>
          قسم رقابة وتنظيم النفايات
        </div>
        <div class="logo-box">شعار البلدية</div>
        <div class="header-block" style="text-align: left; direction: ltr;">
          <strong>Health &amp; Safety Control</strong>
          Waste Control Regulation Section
        </div>
      </header>

      <div class="permit-title">
        تصريح مزاولة نشاط مكافحة آفات الصحة العامة
      </div>
      <div class="permit-subtitle">
        Public Health Pest Control Company : شركة مكافحة آفات الصحة العامة
      </div>

      <table class="form-table">
        <tbody>
          <tr>
            <td class="table-section" colspan="3">بيانات الشركة</td>
          </tr>
          <tr>
            <th>Company Name</th>
            <td>{{ pirmet.company.name|default:"-" }}</td>
            <td class="rtl-label">اسم الشركة</td>
          </tr>
          <tr>
            <th>Trade License No.</th>
            <td>{{ pirmet.company.number|default:"-" }}</td>
            <td class="rtl-label">رقم الرخصة التجارية</td>
          </tr>
          <tr>
            <th>Trade License Exp.</th>
            <td>{{ pirmet.company.trade_license_exp|default:"-" }}</td>
            <td class="rtl-label">تاريخ انتهاء الرخصة</td>
          </tr>
          <tr>
            <th>Address</th>
            <td>{{ pirmet.company.address|default:"-" }}</td>
            <td class="rtl-label">الموقع</td>
          </tr>
          <tr>
            <th>Tel. Numbers</th>
            <td>{{ pirmet.company.landline|default:"-" }}</td>
            <td class="rtl-label">رقم الهاتف الأرضي</td>
          </tr>
          <tr>
            <th>Contact Numbers</th>
            <td>{{ pirmet.company.owner_phone|default:"-" }}</td>
            <td class="rtl-label">رقم هاتف المالك</td>
          </tr>
          <tr>
            <th>Email</th>
            <td>{{ pirmet.company.email|default:"-" }}</td>
            <td class="rtl-label">البريد الإلكتروني</td>
          </tr>
          <tr>
            <th>Issue Date</th>
            <td>{{ pirmet.issue_date|default:"-" }}</td>
            <td class="rtl-label">تاريخ إصدار التصريح</td>
          </tr>
          <tr>
            <th>Expiry Date</th>
            <td>{{ pirmet.dateOfExpiry|default:"-" }}</td>
            <td class="rtl-label">تاريخ انتهاء التصريح</td>
          </tr>
          <tr>
            <th>Receipt Voucher</th>
            <td>{{ pirmet.PaymentNumber|default:"-" }}</td>
            <td class="rtl-label">رقم إيصال الدفع</td>
          </tr>
        </tbody>
      </table>

      <table class="engineer-table">
        <thead>
          <tr>
            <th colspan="2">Engineer Details بيانات المهندس</th>
          </tr>
          <tr>
            <th>Contact Numbers رقم الهاتف المتحرك</th>
            <th>Engineer Name اسم المهندس</th>
          </tr>
        </thead>
        <tbody>
          {% if pirmet.company.enginer %}
            <tr>
              <td>{{ pirmet.company.enginer.phone|default:"-" }}</td>
              <td>{{ pirmet.company.enginer.name|default:"-" }}</td>
            </tr>
          {% else %}
            <tr>
              <td>-</td>
              <td>-</td>
            </tr>
          {% endif %}
        </tbody>
      </table>

      <table class="activity-table">
        <thead>
          <tr>
            <th colspan="2">Details Of Activities بيانات الأنشطة</th>
          </tr>
          <tr>
            <th>Restricted Activity الأنشطة غير المصرح بها</th>
            <th>Allowance Activity الأنشطة المصرح بها</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              {% if restricted_activities %}
                {% for item in restricted_activities %}
                  {% if item == "public_health_pest_control" %}
                    مكافحة آفات الصحة العامة
                  {% elif item == "flying_insects" %}
                    مكافحة الحشرات الطائرة
                  {% elif item == "rodents" %}
                    مكافحة القوارض
                  {% elif item == "termite_control" %}
                    مكافحة النمل الأبيض
                  {% elif item == "grain_pests" %}
                    مكافحة آفات الحبوب
                  {% else %}
                    {{ item }}
                  {% endif %}
                  <br>
                {% endfor %}
              {% else %}
                -
              {% endif %}
              {% if pirmet.restricted_other %}
                <br>أخرى: {{ pirmet.restricted_other }}
              {% endif %}
            </td>
            <td>
              {% if allowed_activities %}
                {% for item in allowed_activities %}
                  {% if item == "public_health_pest_control" %}
                    مكافحة آفات الصحة العامة
                  {% elif item == "flying_insects" %}
                    مكافحة الحشرات الطائرة
                  {% elif item == "rodents" %}
                    مكافحة القوارض
                  {% elif item == "termite_control" %}
                    مكافحة النمل الأبيض
                  {% elif item == "grain_pests" %}
                    مكافحة آفات الحبوب
                  {% else %}
                    {{ item }}
                  {% endif %}
                  <br>
                {% endfor %}
              {% else %}
                -
              {% endif %}
              {% if pirmet.allowed_other %}
                <br>أخرى: {{ pirmet.allowed_other }}
              {% endif %}
            </td>
          </tr>
        </tbody>
      </table>

      <div class="footer-meta">تاريخ الطباعة: {% now "Y-m-d H:i" %}</div>
    </div>
  </div>
  <script>
    window.addEventListener('load', function () {
      window.print();
    });
  </script>
</body>
</html>
